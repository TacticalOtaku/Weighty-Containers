# Weighty Containers

**Версия**: 1.4.1  
**Совместимость с Foundry VTT**: 12.331  
**Совместимость с системой**: D&D 5e 4.3.5  
**Зависимости**: LibWrapper (рекомендуется, версия 1.13.2.0 или выше)  
**Языки**: Английский (`en.json`), Русский (`ru.json`)

## Описание
Weighty Containers — это модуль для Foundry VTT, который улучшает управление инвентарём в системе D&D 5e, добавляя поддержку контейнеров с функцией снижения веса. Контейнеры могут уменьшать эффективный вес предметов, помещённых в них (например, волшебная сумка, уменьшающая вес предметов вдвое), что делает управление инвентарём более реалистичным и гибким. Модуль полностью интегрируется с системой D&D 5e, поддерживает метрические и имперские единицы веса и предоставляет визуальную обратную связь через полосы прогресса и отображение веса.

## Возможности
- **Снижение веса**: Настройте контейнеры для уменьшения веса предметов внутри на определённый процент (от 0% до 100%). Например, контейнер с 50% снижением делает предмет весом 12 кг весом 6 кг внутри.
- **Ограничения вместимости контейнеров**: Устанавливайте лимиты веса для контейнеров, предотвращая перегрузку с настраиваемыми сообщениями об ошибке.
- **Полосы прогресса**: Отображайте уровень заполнения контейнеров с помощью настраиваемых CSS-селекторов для полос прогресса и значений веса.
- **Поддержка метрической и имперской систем**: Полная совместимость с настройкой `metricWeightUnits` в D&D 5e. Веса обрабатываются как килограммы (кг) в метрическом режиме и фунты (lb) в имперском.
- **Синхронизация в мультиплеере**: Обновления содержимого контейнеров или настроек снижения веса синхронизируются между всеми клиентами в реальном времени.
- **Совместимость**: Работает с модулями Plutonium (2.6.2), ItemPiles, Midi-QOL, DAE и другими популярными модулями.

## Установка
1. В Foundry VTT перейдите на вкладку **Дополнительные модули** в меню настройки.
2. Нажмите **Установить модуль** и найдите `Weighty Containers`.
3. Либо вставьте следующий URL манифеста в поле **URL манифеста**:
   ```
   https://github.com/your-repo/weighty-containers/releases/latest/download/module.json
   ```
4. Нажмите **Установить** и активируйте модуль в вашем мире.
5. (Опционально) Убедитесь, что модуль LibWrapper установлен и активирован для оптимальной производительности.

## Использование
### Создание контейнера с уменьшением веса
1. Создайте новый предмет типа **Контейнер** в инвентаре персонажа.
2. Установите **Лимит веса** контейнера (например, 20 кг или 40 фунтов) в деталях предмета.
3. Если вы ГМ (или настройка `gmOnlyConfig` отключена), в заголовке листа контейнера появится кнопка настройки.
4. Нажмите кнопку настройки, чтобы установить **Процент снижения веса** (от 0% до 100%).
   - Пример: 50% снижение означает, что предметы внутри весят половину своего обычного веса.
5. Добавьте предметы в контейнер, указав ID контейнера в поле **Контейнер** или перетаскивая их в контейнер в листе персонажа.

### Расчёт веса
- **Метрический режим** (`dnd5e.metricWeightUnits` включена):
  - Веса, введённые в интерфейсе, считаются килограммами (кг).
  - Предмет весом 12 кг в контейнере с 50% снижением весит 6 кг внутри.
  - Лимиты вместимости контейнеров также в кг (например, лимит 20 кг).
- **Имперский режим**:
  - Веса считаются фунтами (lb).
  - Предмет весом 12 фунтов в контейнере с 50% снижением весит 6 фунтов внутри.
- Модуль автоматически корректирует нагрузку персонажа, учитывая эффективный вес предметов в контейнерах с уменьшением веса.

### Настройки
Настройки модуля доступны в меню **Настройки** на вкладке **Модули**:
- **Только для ГМ** (`gmOnlyConfig`): Ограничивает настройку снижения веса только для ГМ (по умолчанию: включено).
- **Сообщение о превышении вместимости** (`capacityExceededMessage`): Настройте сообщение, отображаемое при превышении лимита контейнера.
- **Делитель валюты** (`currencyDivisor`): Установите количество монет, эквивалентное 1 единице веса (по умолчанию: 50).
- **Селекторы прогресса** (`progressSelectors`): Продвинутые пользователи могут настроить CSS-селекторы для полос прогресса.
- **Селекторы значений** (`valueSelectors`): Настройте CSS-селекторы для отображения значений веса.

## Совместимость
- **Foundry VTT**: Протестировано с версией 12.331.
- **D&D 5e**: Полная совместимость с версией 4.3.5, включая метрическую и имперскую системы веса.
- **Модули**:
  - **Plutonium (2.6.2)**: Поддерживает пользовательские макеты листов через настраиваемые селекторы.
  - **LibWrapper (1.13.2.0)**: Рекомендуется для бесконфликтной обёртки методов (используется ручная заплатка, если недоступен).
  - **ItemPiles, Midi-QOL, DAE**: Конфликты не обнаружены; протестировано совместно с этими модулями.
- **Ограничения**:
  - Типы актёров NPC и транспорт не поддерживаются для отображения снижения веса.
  - Временные предметы обходят проверки вместимости, чтобы не нарушать рабочие процессы.

## Журнал изменений
### Версия 1.4.1 (7 мая 2025)
- Исправлены некорректные расчёты веса в метрическом режиме, обеспечивающие правильное снижение веса предметов в контейнерах (например, предмет 12 кг в контейнере с 50% снижением теперь корректно весит 6 кг).
- Улучшена обработка метрических и имперских единиц для согласованности с лимитами контейнеров и нагрузкой персонажа.
- Сохранена совместимость с Foundry VTT 12.331, D&D 5e 4.3.5 и связанными модулями.

## Авторы
- **Автор**: [TacticalOtaku]
- **Соавторы**: Спасибо сообществу Foundry VTT за обратную связь и тестирование.
- **Лицензия**: MIT License

Наслаждайтесь лёгкими грузами с Weighty Containers!