# Weighty Containers

Foundry VTT Module for Dungeons & Dragons 5th Edition

## Обзор

Этот модуль расширяет функциональность предметов-контейнеров в системе D&D 5e для Foundry VTT. Он добавляет реалистичное отслеживание веса содержимого, возможность для контейнеров магически снижать вес находящихся в них предметов и корректно отображает итоговую нагрузку на листе персонажа.

## Основные Возможности

   Лимит Вместимости по Весу Модуль строго следит за максимальным весом, который может вместить контейнер (если он настроен на ограничение по весу). Попытки добавить предметы (перетаскиванием, изменением количества, через Item Piles), превышающие лимит с учетом эффективного веса, будут заблокированы.
   Процентное Снижение Веса Позволяет устанавливать для каждого контейнера индивидуальный процент (от 0% до 100%), на который снижается вес всех предметов, находящихся внутри него.
   Динамический Вес Снижение веса применяется только пока предмет находится внутри контейнера. Как только предмет извлекается, его вес возвращается к базовому значению.
   Интерфейс на Листе Контейнера
       Отображает текущий процент снижения веса прямо в шапке листа контейнера.
       Цвет индикатора процента соответствует редкости или силе снижения (по аналогии с цветами редкости предметов D&D 5e).
       Добавляет кнопку с иконкой шестеренки (i class=fas fa-cogsi) для быстрой настройки процента снижения веса этого контейнера.
       Добавляет чекбокс на вкладке Details для включениявыключения снижения веса валюты этим контейнером.
   Корректное Отображение Нагрузки
       Общий вес персонажа (encumbrance) на листе персонажа теперь учитывает эффективный вес предметов, находящихся в контейнерах со снижением веса.
       Вес валюты также может быть снижен, если персонаж несет хотя бы один контейнер с включенной опцией снижения веса валюты (применяется лучший процент скидки).
       Текущий эффективный вес содержимого отображается на листе самого контейнера (на вкладке Contents), когда он открыт из инвентаря актора.
   Настройки Модуля
       Опция для ограничения доступа к кнопке настройки процента снижения веса только для GM.
       Возможность задать собственный текст уведомления, которое появляется при попытке превысить лимит веса контейнера.
   Совместимость
       Должен быть совместим с модулем `rarity-colors` (использует стандартные CSS переменные).
       Интегрируется с модулем `Item Piles` для проверки веса при добавлении предметов в кучу-контейнер.

## Установка

1.  Через Манифест (Рекомендуется)
       В меню настройки Foundry VTT перейдите на вкладку Add-on Modules.
       Нажмите Install Module.
       В поле Manifest URL вставьте следующую ссылку (замените на реальную ссылку, если вы загрузите модуль) `СЮДА_ВСТАВИТЬ_ССЫЛКУ_НА_MANIFEST.JSON`
       Нажмите Install.
2.  Вручную
       Скачайте zip-архив модуля.
       Распакуйте его в папку `Datamodulesweighty-containers` в вашей директории пользователя Foundry VTT.
       Перезапустите Foundry VTT.

После установки не забудьте активировать модуль Weighty Containers в настройках вашего мира.

## Использование и Настройка

1.  Настройка Контейнера
       Чтобы модуль заработал для конкретного контейнера (например, Рюкзака), откройте его лист настроек (из директории Items).
       Перейдите на вкладку Details.
       Установите Capacity Type в значение Weight.
       Установите Max Weight в желаемое числовое значение (больше 0).
       Сохраните изменения.
2.  Настройка Снижения Веса
       Добавьте настроенный контейнер в инвентарь персонажа.
       Откройте лист контейнера из инвентаря персонажа.
       В шапке листа (под названием) вы увидите текущий процент снижения (по умолчанию 0%) и иконку шестеренки i class=fas fa-cogsi (если у вас есть права на настройку).
       Нажмите на иконку шестеренки.
       Введите желаемый процент снижения (0-100) и нажмите Save. Процент и цвет индикатора обновятся.
3.  Настройка Снижения Веса Валюты
       Откройте лист весового контейнера (из инвентаря или директории).
       Перейдите на вкладку Details.
       Найдите чекбокс Снижает вес валюты (или Reduces Currency Weight).
       Отметьте его, если этот контейнер должен влиять на вес монет персонажа.
       Скидка будет применяться к общему весу валюты персонажа на основе лучшего процента среди всех контейнеров с этой включенной опцией, которые несет персонаж.
4.  Проверка Лимита
       Теперь при попытке добавить предмет в этот контейнер на листе персонажа (или через Item Piles), модуль проверит, не превысит ли эффективный вес (базовый вес  (1 - скидка100)) лимит контейнера.
       Если лимит будет превышен, вы увидите уведомление (стандартное или ваше кастомное), и операция будет заблокирована.
5.  Отображение Веса
       На листе контейнера (вкладка Contents) Когда лист открыт из инвентаря актора, отображаемый текущий вес и полоска загрузки будут показывать эффективный вес содержимого.
       На листе актора (инвентарь) Рядом с базовым весом предмета, находящегося в контейнере со скидкой, в скобках будет показан его эффективный вес.
       На листе актора (общая загрузка) Показатели общей загрузки персонажа (например, 4  165) будут учитывать эффективный вес всех переносимых предметов, включая скидки от контейнеров и вес валюты со скидкой.
6.  Настройки Модуля
       В меню настроек Foundry VTT (Configure Settings - Module Settings) найдите Weighty Containers.
       Restrict Config Button to GM Отметьте, чтобы только GM мог изменять процент снижения веса на листах контейнеров.
       Capacity Exceeded Message Введите свой текст уведомления о превышении лимита (по умолчанию Больно ты дохуя взял).

## Совместимость

   Foundry VTT Проверено на v12.331. Требуется v12.324+.
   D&D 5e System Проверено на v4.3.9. Требуется v3.2.0+.
   libWrapper Рекомендуется. Модуль будет использовать `libWrapper`, если он установлен и активен, для более надежного изменения расчета загрузки персонажа. Без него используется ручной патчинг, что менее стабильно при обновлениях системы.
   Item Piles Интегрирована базовая проверка веса при добавлении предметов через API Item Piles.
   Rarity Colors Совместимость должна работать из коробки, так как используются стандартные CSS переменные.
   Другие Модули Листов Модуль вставляет UI в стандартные места листа предметов dnd5e. Если вы используете сильно кастомизированные листы предметов (например, Tidy5e Sheet старых версий, DF Item Sheets и т.д.), UI модуля (процент, кнопка) может не отображаться. Отображение веса на листе контейнера также зависит от стандартной структуры HTML.

## Известные Ограничения

   UI на листе контейнера может не отображаться на нестандартных листах предметов.
   Отображение эффективного веса содержимого на листе контейнера работает только при открытии листа из инвентаря актора.
   Патчинг расчета загрузки актора может перестать работать при значительных обновлениях системы dnd5e.

## Лицензия

Этот модуль выпущен под лицензией MIT.

## Автор

TacticalOtaku

---

https://raw.githubusercontent.com/TacticalOtaku/Weighty-Containers/main/module.json