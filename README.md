# Weighty Containers

**Weighty Containers** — это модуль для Foundry VTT, разработанный для системы D&D 5e. Он расширяет функциональность контейнеров, позволяя задавать процент снижения веса (например, для магических сумок, таких как *Сумка Хранения*) и ограничивать вместимость по весу. Модуль интегрируется с расчетами нагрузки персонажа и предоставляет удобный интерфейс для управления контейнерами.

## Возможности
- **Снижение веса**: Устанавливайте процент снижения веса для контейнеров (0–100%), уменьшая эффективный вес содержимого.
- **Ограничение вместимости**: Контролируйте максимальный вес содержимого, блокируя добавление предметов при превышении лимита.
- **Интерфейс**: Отображение процента снижения веса, эффективного веса предметов и полосы заполнения на листах предметов и персонажа.
- **Интеграция с нагрузкой**: Учет сниженного веса в контейнерах и веса валюты при расчете общей нагрузки персонажа.
- **Настройки**: Возможность ограничить настройку контейнеров только для ГМа и изменить сообщение о превышении вместимости.
- **Визуальная обратная связь**: Контейнеры получают CSS-классы редкости в зависимости от процента снижения веса (например, Легендарный для ≥75%).

## Установка
1. В Foundry VTT откройте вкладку **Дополнения** (*Add-on Modules*).
2. Нажмите **Установить модуль** и найдите **Weighty Containers**.
3. Или вставьте URL манифеста модуля: `[https://raw.githubusercontent.com/TacticalOtaku/Weighty-Containers/main/module.json`.
4. Нажмите **Установить** и активируйте модуль в настройках мира через **Управление модулями**.

## Использование
1. **Создание контейнера**:
   - Создайте предмет с типом `container` в инвентаре персонажа.
   - Укажите максимальную вместимость по весу в поле `system.capacity.weight.value`.
   - Откройте лист контейнера и нажмите на иконку шестеренки (если разрешено), чтобы задать процент снижения веса (0–100%).

2. **Добавление предметов**:
   - Перетащите предметы в контейнер через инвентарь персонажа или укажите ID контейнера в поле `system.container`.
   - Модуль заблокирует добавление, если эффективный вес превысит вместимость, и покажет настраиваемое предупреждение.

3. **Просмотр веса**:
   - На листе контейнера отображается текущий вес и полоса заполнения, показывающая процент загрузки.
   - На листе персонажа предметы в контейнерах с пониженным весом показывают эффективный вес (например, `6 фунтов (Эфф: 3 фунта)`).
   - Контейнеры в инвентаре персонажа отображают полосу заполнения.

4. **Валюта**:
   - Вес валюты автоматически учитывается в нагрузке персонажа (по стандарту D&D 5e: 50 монет = 1 фунт, с учетом метрических настроек).

## Настройки
- **Настройка только для ГМа** (`gmOnlyConfig`):
  - По умолчанию: `true`
  - Если включено, только ГМ может задавать процент снижения веса для контейнеров.
  - Отключите, чтобы позволить игрокам настраивать свои контейнеры.
- **Сообщение о превышении вместимости** (`capacityExceededMessage`):
  - По умолчанию: "Больно ты дохуя взял" (настраиваемо)
  - Текст, отображаемый при попытке добавить предметы сверх вместимости контейнера.

## Совместимость
- **Система**: Разработан для D&D 5e в Foundry VTT.
- **Модули**: Поддерживает `libWrapper` для безопасного патчинга методов. Совместим с большинством кастомных листов, но может потребовать дополнительные CSS-селекторы для полос заполнения в нестандартных интерфейсах.
- **Единицы измерения**: Учитывает настройки метрических и имперских единиц D&D 5e для отображения и расчетов веса.

## Известные проблемы
- Полосы заполнения могут некорректно отображаться в сильно кастомизированных листах. Добавьте дополнительные селекторы в функцию `updateContainerProgressBar`, если необходимо.
- Временные предметы не проверяются на ограничение вместимости, чтобы не мешать игровому процессу.

## Лицензия
Модуль распространяется под [лицензией MIT](LICENSE).

## Авторы
Разработан для сообщества Foundry VTT, чтобы улучшить управление инвентарем в кампаниях D&D 5e. by TacticalOtaku